{"version":3,"sources":["pages/role/EditModal.jsx","pages/role/index.jsx"],"names":["EditModal","config","ajax","modal","title","props","isEdit","state","loading","data","fetchData","id","setState","get","then","res","finally","handleSubmit","values","successTip","ajaxMethod","put","post","onOk","this","formProps","labelWidth","okText","cancelText","form","submit","onCancel","resetFields","ref","onFinish","initialValues","type","name","label","required","Component","UserCenter","path","dataSource","total","pageNum","pageSize","deleting","visible","columns","dataIndex","width","render","value","record","items","onClick","color","confirm","onConfirm","handleDelete","handle2","params","list","del","errorTip","style","paddingLeft","field","layout","htmlType","icon","text","serialNumber","rowKey","onPageNumChange","onPageSizeChange"],"mappings":"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","file":"static/js/10.b0135afc.chunk.js","sourcesContent":["import React, {Component} from 'react';\nimport {Form} from 'antd';\nimport {FormElement} from 'src/library/components';\nimport config from 'src/commons/config-hoc';\nimport {ModalContent} from 'src/library/components';\n\n@config({\n    ajax: true,\n    modal: {\n        title: props => props.isEdit ? '修改' : '添加',\n    },\n})\nexport default class EditModal extends Component {\n    state = {\n        loading: false, // 页面加载loading\n        data: {},       // 表单回显数据\n    };\n\n    componentDidMount() {\n        const {isEdit} = this.props;\n\n        if (isEdit) {\n            this.fetchData();\n        }\n    }\n\n    fetchData = () => {\n        if (this.state.loading) return;\n\n        const {id} = this.props;\n\n        this.setState({loading: true});\n        this.props.ajax.get(`/role/${id}`)\n            .then(res => {\n                this.setState({data: res || {}});\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n\n        const {isEdit} = this.props;\n        const successTip = isEdit ? '修改成功！' : '添加成功！';\n        const ajaxMethod = isEdit ? this.props.ajax.put : this.props.ajax.post;\n        const ajaxUrl = isEdit ? '/role' : '/role';\n\n        this.setState({loading: true});\n        ajaxMethod(ajaxUrl, values, {successTip})\n            .then(() => {\n                const {onOk} = this.props;\n                onOk && onOk();\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    render() {\n        const {isEdit} = this.props;\n        const {loading, data} = this.state;\n        const formProps = {\n            labelWidth: 100,\n        };\n        return (\n            <ModalContent\n                loading={loading}\n                okText=\"保存\"\n                cancelText=\"重置\"\n                onOk={() => this.form.submit()}\n                onCancel={() => this.form.resetFields()}\n            >\n                <Form\n                    ref={form => this.form = form}\n                    onFinish={this.handleSubmit}\n                    initialValues={data}\n                >\n                    {isEdit ? <FormElement {...formProps} type=\"hidden\" name=\"id\"/> : null}\n                    <FormElement\n                        {...formProps}\n                        label=\"角色名称\"\n                        name=\"name\"\n                        required\n                    />\n                    <FormElement\n                        {...formProps}\n                        label=\"描述\"\n                        name=\"description\"\n                    />\n                </Form>\n            </ModalContent>\n        );\n    }\n}\n","import React, {Component} from 'react';\nimport {Button, Form, } from 'antd';\nimport PageContent from 'src/layouts/page-content';\nimport config from 'src/commons/config-hoc';\nimport {\n    QueryBar,\n    FormRow,\n    FormElement,\n    ToolBar,\n    Table,\n    Operator,\n    Pagination,\n} from 'src/library/components';\nimport EditModal from './EditModal';\n\n@config({\n    path: '/roles',\n    ajax: true,\n})\nexport default class UserCenter extends Component {\n    state = {\n        loading: false,     // 表格加载数据loading\n        dataSource: [],     // 表格数据\n        total: 0,           // 分页中条数\n        pageNum: 1,         // 分页当前页\n        pageSize: 20,       // 分页每页显示条数\n        deleting: false,    // 删除中loading\n        visible: false,     // 添加、修改弹框\n        id: null,           // 需要修改的数据id\n    };\n\n    columns = [\n        {title: '角色名称', dataIndex: 'name', width: 200},\n        {title: '描述', dataIndex: 'description', width: 200},\n        {\n            title: '操作', dataIndex: 'operator', width: 100,\n            render: (value, record) => {\n                const {id, name} = record;\n                const items = [\n                    {\n                        label: '修改',\n                        onClick: () => this.setState({visible: true, id}),\n                    },\n                    {\n                        label: '删除',\n                        color: 'red',\n                        confirm: {\n                            title: `您确定删除\"${name}\"?`,\n                            onConfirm: () => this.handleDelete(id),\n                        },\n                    },\n                    {\n                        label: '权限',\n                        onClick: this.handle2,\n                    },\n                ];\n\n                return <Operator items={items}/>\n            },\n        },\n    ];\n\n    componentDidMount() {\n        this.handleSubmit();\n    }\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n\n        const {pageNum, pageSize} = this.state;\n        const params = {\n            ...values,\n            pageNum,\n            pageSize,\n        };\n\n        this.setState({loading: true});\n        this.props.ajax.get('/mock/role', params)\n            .then(res => {\n                const dataSource = res?.list || [];\n                const total = res?.total || 0;\n\n                this.setState({dataSource, total});\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    handleDelete = (id) => {\n        if(this.state.deleting) return;\n\n        this.setState({deleting: true});\n        this.props.ajax.del(`/role/${id}`, null, {successTip: '删除成功！', errorTip: '删除失败！'})\n            .then(() => this.form.submit())\n            .finally(() => this.setState({deleting: false}));\n    };\n\n\n    handle2 = () => {\n        // TODO\n    };\n\n    render() {\n        const {\n            loading,\n            dataSource,\n            total,\n            pageNum,\n            pageSize,\n            visible,\n            id,\n        } = this.state;\n\n        const {form} = this.props;\n        const formProps = {\n            form,\n            width: 220,\n            style: {paddingLeft: 16},\n        };\n\n        return (\n            <PageContent>\n                <QueryBar>\n                    <Form onFinish={this.handleSubmit} ref={form => this.form = form}>\n                        <FormRow>\n                            <FormElement\n                                {...formProps}\n                                label=\"角色名\"\n                                field=\"name\"\n                            />\n                            <FormElement layout width=\"auto\">\n                                <Button type=\"primary\" htmlType=\"submit\">提交</Button>\n                                <Button onClick={() => form.resetFields()}>重置</Button>\n                            </FormElement>\n                        </FormRow>\n                    </Form>\n                </QueryBar>\n                <ToolBar\n                    items={[\n                        {\n                            type: 'primary',\n                            icon: 'plus',\n                            text: '添加',\n                            onClick: () => this.setState({visible: true, id: null}),\n                        },\n\n                    ]}\n                />\n                <Table\n                    serialNumber\n                    loading={loading}\n                    columns={this.columns}\n                    dataSource={dataSource}\n                    rowKey=\"id\"\n                    pageNum={pageNum}\n                    pageSize={pageSize}\n                />\n                <Pagination\n                    total={total}\n                    pageNum={pageNum}\n                    pageSize={pageSize}\n                    onPageNumChange={pageNum => this.setState({pageNum}, this.form.submit)}\n                    onPageSizeChange={pageSize => this.setState({pageSize, pageNum: 1}, this.form.submit)}\n                />\n                <EditModal\n                    visible={visible}\n                    id={id}\n                    isEdit={id !== null}\n                    onOk={() => this.setState({visible: false}, this.form.submit)}\n                    onCancel={() => this.setState({visible: false})}\n                />\n            </PageContent>\n        );\n    }\n}\n"],"sourceRoot":""}